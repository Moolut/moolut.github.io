---
import TVLayout from '../layouts/TVLayout.astro'
import CVSection from '../components/CVSection.astro'
import Badge from '../components/Badge.astro'
import { education, workExperience, skills } from '../modules/cv-data'

// Transform education data for terminal CVSection component
const educationItems = education.map((edu) => ({
  title: edu.institution,
  subtitle: edu.degree,
  period: edu.period,
  location: edu.location,
  gpa: edu.gpa,
  technologies: edu.technologies,
  highlights: edu.highlights,
}))

// Transform work experience data for terminal CVSection component
const workItems = workExperience.map((work) => ({
  title: work.company,
  subtitle: work.position,
  period: work.period,
  location: work.location,
  technologies: work.technologies,
  highlights: work.highlights,
  positions: work.positions,
}))
---

<TVLayout title="whoami">
  <article class="whoami">
    <nav class="page-nav">
      <a href="#education" class="page-nav__link">Education</a>
      <a href="#work-experience" class="page-nav__link">Work Experience</a>
      <a href="#skills" class="page-nav__link">Tech Skills</a>
      <a href="#languages" class="page-nav__link">Languages</a>
    </nav>

    <h1 class="page-title">
      <span class="terminal-prompt">$</span> <span class="whoami-text">WHOAMI</span>
    </h1>

    <div id="education">
      <CVSection title="Education" items={educationItems} />
    </div>

    <div id="work-experience">
      <CVSection title="Work Experience" items={workItems} />
    </div>

    <section class="terminal-section" id="skills">
      <h2 class="terminal-header">
        <span class="prompt">$</span>
        <span class="command">cat</span>
        <span class="filename">skills_&_technologies.txt</span>
      </h2>
      <div class="terminal-content">
        <div class="skills-grid">
          <div class="skill-category">
            <h3 class="skill-category__title">
              <span class="category-prompt">></span> Technologies
            </h3>
            <div class="badges">
              {skills.technologies.map((tech) => <Badge label={tech} />)}
            </div>
          </div>
          <div class="skill-category">
            <h3 class="skill-category__title">
              <span class="category-prompt">></span> Skills
            </h3>
            <div class="badges">
              {skills.skills.map((skill) => <Badge label={skill} variant="secondary" />)}
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="terminal-section" id="languages">
      <h2 class="terminal-header">
        <span class="prompt">$</span>
        <span class="command">cat</span>
        <span class="filename">languages.txt</span>
      </h2>
      <div class="terminal-content">
        <ul class="languages-list">
          {
            skills.languages.map((lang) => {
              const proficiencyMap = {
                'Mother tongue': 100,
                'C1 (Advanced)': 85,
                'B1 (Intermediate)': 60,
              }
              const proficiency = proficiencyMap[lang.level] || 50

              return (
                <li>
                  <div class="lang-header">
                    <span class="lang-prompt">></span>
                    <strong>{lang.name}</strong>
                    <span class="lang-level">{lang.level}</span>
                  </div>
                  <div class="lang-proficiency">
                    <div class="lang-proficiency-fill" style={`width: ${proficiency}%`}></div>
                  </div>
                </li>
              )
            })
          }
        </ul>
      </div>
    </section>
  </article>
</TVLayout>

<style>
  /* Remove glitchy text effect from body content */
  .whoami,
  .whoami * {
    text-shadow: none !important;
  }

  .whoami {
    max-width: 100%;
  }

  /* Sticky page navigation - retro TV theme */
  .page-nav {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(0, 0, 0, 0.9);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    padding: 1rem 0;
    margin: -2rem 0 3rem 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    flex-wrap: wrap;
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
  }

  .page-nav__link {
    font-family: inherit;
    font-size: clamp(13px, 1.5vw, 16px);
    text-transform: uppercase;
    color: var(--text-secondary);
    text-decoration: none;
    padding: 0.25rem 0;
    position: relative;
    transition: background-size 0.2s cubic-bezier(0.29, 0.8, 0.21, 0.63);
    background-position: center center;
    background-size: 90% 0;
    background-repeat: no-repeat;
  }

  /* Rainbow-static effect on hover */
  html:not(.webp) .page-nav__link {
    background-image: url(/assets/images/rainbow-static.gif);
  }

  html.webp .page-nav__link {
    background-image: url(/assets/images/rainbow-static.webp);
  }

  .page-nav__link:hover {
    cursor: var(--cursor-pointer);
    background-size: 100% 100%;
  }

  .page-nav__link:focus {
    outline: none;
    background-size: 100% 100%;
  }

  .page-title {
    margin-bottom: 3rem;
    font-family: 'Courier New', Courier, monospace;
    font-size: clamp(20px, 3.5vw, 32px);
    color: var(--text-secondary);
    font-weight: normal;
    text-transform: uppercase;
  }

  .terminal-prompt {
    color: #0f0;
    margin-right: 0.75rem;
    font-weight: bold;
  }

  .whoami-text {
    display: inline-block;
    position: relative;
    color: var(--text-secondary);
    font-weight: bold;
    background-position: center center;
    background-size: 100% 0;
    background-repeat: no-repeat;
    transition: background-size 0.5s cubic-bezier(0.29, 0.8, 0.21, 0.63);
    padding: 0.1em 0.2em;
  }

  html:not(.webp) .whoami-text {
    background-image: url(/assets/images/rainbow-static.gif);
  }

  html.webp .whoami-text {
    background-image: url(/assets/images/rainbow-static.webp);
  }

  .whoami-text.changing {
    background-size: 100% 100%;
    color: transparent;
  }

  .terminal-section {
    margin-bottom: 3rem;
    border: 2px solid var(--text-secondary);
    background: rgba(0, 0, 0, 0.3);
    padding: 0;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
  }

  .terminal-header {
    margin: 0;
    padding: 0.75rem 1.25rem;
    background: linear-gradient(
      to bottom,
      rgba(0, 255, 0, 0.15),
      rgba(0, 255, 0, 0.05)
    );
    border-bottom: 2px solid #0f0;
    font-family: 'Courier New', Courier, monospace;
    font-size: clamp(15px, 1.8vw, 20px);
    color: var(--text-secondary);
    font-weight: normal;
    letter-spacing: 0.05em;
  }

  .prompt {
    color: #0f0;
    margin-right: 0.75rem;
    font-weight: bold;
    font-size: 1.1em;
  }

  .command {
    color: #ff0;
    font-weight: bold;
    margin-right: 0.5rem;
  }

  .filename {
    color: var(--text-secondary);
    font-style: italic;
  }

  .terminal-content {
    padding: 1.5rem;
  }

  .skills-grid {
    display: grid;
    gap: 2.5rem;
  }

  .skill-category__title {
    font-family: 'Courier New', Courier, monospace;
    font-size: clamp(15px, 1.7vw, 19px);
    text-transform: uppercase;
    margin-bottom: 1.25rem;
    color: var(--text-secondary);
    font-weight: bold;
  }

  .category-prompt {
    color: #0f0;
    margin-right: 0.5rem;
    font-weight: bold;
  }

  .badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .languages-list {
    list-style: none;
    padding: 0;
    margin: 0;
    font-family: 'Courier New', Courier, monospace;
  }

  .languages-list li {
    font-size: clamp(14px, 1.6vw, 18px);
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    transition: all 0.3s ease;
    position: relative;
  }

  .languages-list li:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .languages-list li:hover {
    transform: translateX(5px);
  }

  .lang-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .lang-prompt {
    color: #0f0;
    font-weight: bold;
  }

  .languages-list strong {
    color: var(--text-secondary);
    text-transform: uppercase;
  }

  .lang-level {
    color: rgba(255, 255, 255, 0.6);
    font-size: clamp(12px, 1.4vw, 15px);
  }

  .lang-proficiency {
    width: 100%;
    height: 8px;
    background: rgba(0, 255, 0, 0.1);
    border: 1px solid rgba(0, 255, 0, 0.3);
    border-radius: 2px;
    overflow: hidden;
    opacity: 0;
    transform: scaleX(0);
    transform-origin: left;
    transition: all 0.4s cubic-bezier(0.29, 0.8, 0.21, 0.63);
  }

  .languages-list li:hover .lang-proficiency {
    opacity: 1;
    transform: scaleX(1);
  }

  .lang-proficiency-fill {
    height: 100%;
    background: linear-gradient(90deg, #0f0, #0f0 50%, rgba(0, 255, 0, 0.5));
    box-shadow: 0 0 10px #0f0;
    transition: width 0.6s cubic-bezier(0.29, 0.8, 0.21, 0.63);
  }

  @media (min-width: 768px) {
    .skills-grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  @media (max-width: 580px) {
    .terminal-content {
      padding: 1rem;
    }

    .page-nav {
      padding: 0.75rem 0;
      gap: 1.5rem;
    }

    .page-nav__link {
      font-size: clamp(12px, 1.4vw, 14px);
    }
  }
</style>

<script>
  // Smooth scroll for navigation links
  function initNavLinks() {
    const navLinks = document.querySelectorAll('.page-nav__link');
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href');
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
          targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  }

  // Initialize on page load
  initNavLinks();

  // Reinitialize after client-side navigation
  document.addEventListener('astro:after-swap', initNavLinks);

  // Rainbow cycling for whoami title
  const titles = ['WHOAMI', 'moolut', 'Mevlüt Yıldırım'];
  let titleIndex = 0;
  let intervalId = null;

  function initTitleCycling() {
    const titleElement = document.querySelector('.whoami-text');
    if (!titleElement) return;

    if (intervalId) {
      clearInterval(intervalId);
    }

    function cycleTitle() {
      titleElement.classList.add('changing');

      setTimeout(() => {
        titleIndex = (titleIndex + 1) % titles.length;
        titleElement.textContent = titles[titleIndex];

        setTimeout(() => {
          titleElement.classList.remove('changing');
        }, 400);
      }, 200);
    }

    intervalId = setInterval(cycleTitle, 3000);
  }

  initTitleCycling();
  document.addEventListener('astro:after-swap', initTitleCycling);
</script>
